<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>D3 Example</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="test4.js"></script>
	
	<style>
	.chart {
		background: white;
		width: 500px;
		height: 250px;
		border-left: 1px dotted #555;
		border-bottom: 1px dotted #555;
		padding: 20px 0px 0px 0px;
	}
	
	.unclicked {
		cursor:pointer;
		fill: none;
	}
	
	.clicked {
		cursor:pointer;
		fill: gray;
	}
	
	.clickable {
		cursor:pointer;
	}
	
	.labelClicked {
		paint-order: stroke;
		stroke: gray;
		stroke-width: 1px;
		stroke-linecap: butt;
		stroke-linejoin: miter;
	}
	
	.main_graph_head_border{
		display:none;
	}
	
	.sub_graph_head_border {
		display:none;
	}
		
	</style>
	
  </head>
  <body>
   
	<div id="div1">
		<table id = "table_main_graph" border=1>
			<tr>
				<td id= "main_graph_td">
				</td>
			</tr>
		</table>
	</div>
	<br>
	<br>
	<div id="div2">
		<table id = "table_sub_graph" border=1>
		</table>
	</div>
	
	
		<script>
		
	function getMyArrayOfObjects(cname) {
	  
	  var myArrayOfObjects;
	  
		if(cname == 'ABC') {
		
			myArrayOfObjects = [ 
				{ cid: 1, cname:'abc1', w: 3}, 
				{ cid: 2, cname:'abc2', w: 5}, 
				{ cid: 3, cname:'abc3', w: 1}, 
				{ cid: 4, cname:'abc4', w: 8}, 
				{ cid: 5, cname:'abc5', w: 4} 
			];
			
		}
		
		else if(cname == 'DEF') {
			myArrayOfObjects = [ 
				{ cid: 1, cname:'def1', w: 10}, 
				{ cid: 2, cname:'def2', w: 2}, 
				{ cid: 3, cname:'def3', w: 5}, 
				{ cid: 4, cname:'def4', w: 1}, 
				{ cid: 5, cname:'def5', w: 9} 
			];
		
		}
		else if(cname == 'GHI') {
			myArrayOfObjects = [ 
				{ cid: 1, cname:'ghi1', w: 1}, 
				{ cid: 2, cname:'ghi2', w: 6}, 
				{ cid: 3, cname:'ghi3', w: 1}, 
				{ cid: 4, cname:'ghi4', w: 9}, 
				{ cid: 5, cname:'ghi5', w: 4} 
			];
		
		}
		else if(cname == 'JKL') {
			myArrayOfObjects = [ 
				{ cid: 1, cname:'jkl1', w: 1}, 
				{ cid: 2, cname:'jkl2', w: 4}, 
				{ cid: 3, cname:'jkl3', w: 5}, 
				{ cid: 4, cname:'jkl4', w: 4}, 
				{ cid: 5, cname:'jkl5', w: 10} 
			];
		
		}
		else if(cname == 'MNO') {
			myArrayOfObjects = [ 
				{ cid: 1, cname:'mno1', w: 1}, 
				{ cid: 2, cname:'mno2', w: 2}, 
				{ cid: 3, cname:'mno3', w: 8}, 
				{ cid: 4, cname:'mno4', w: 14}, 
				{ cid: 5, cname:'mno5', w: 10} 
			];
		
		}
		
		return myArrayOfObjects;
	  }
     	
	var map = new Object();
	var mapSubGraphSVG = new Object();
	
	  function axis_MainGraph(svg) {
						
		svg.append("line")
		.attr("x1", 99)
		.attr("y1", 50)
		.attr("x2", 99)
		.attr("y2", 300)
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "main_graph");
		
		svg.append("line")
		.attr("x1", 99)
		.attr("y1", 300)
		.attr("x2", 499)
		.attr("y2", 300)
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "main_graph");
		
		
		svg.append("text")
		.attr("x", 220)
		.attr("y", 320)
		.attr("fill", "black")
		.text("Frequency")
		.attr("class", "main_graph");
		
	  }
	  
	  function axis_SubGraph(svg, cname) {
						
		mapSubGraphSVG[cname] = svg;
		
		svg.append("line")
		.attr("x1", 99)
		.attr("y1", 50)
		.attr("x2", 99)
		.attr("y2", 300)
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "sub_graph_"+cname);
		
		
		svg.append("line")
		.attr("x1", 99)
		.attr("y1", 300)
		.attr("x2", 499)
		.attr("y2", 300)
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "sub_graph_"+cname);
		
		
		svg.append("text")
		.attr("x", 220)
		.attr("y", 320)
		.attr("fill", "black")
		.text("Frequency")
		.attr("class", "sub_graph_"+cname);
		
		
		svg.append("rect")
		.attr("x", 20)
		.attr("y", 10)
		.attr("width", 470)
		.attr("height", 35)
		.attr("fill", "none")
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "sub_graph_head_border")
		.attr("id", "sub_graph_head_border_"+cname);
		
		svg.append("text")
		.attr("x", 30)
		.attr("y", 30)
		.attr("fill", "black")
		.text(cname + ":");
		
		svg.append("rect")
		.attr("x", 200)
		.attr("y", 10)
		.attr("width", 75)
		.attr("height", 30)
		.attr("class", "sub_graph_"+cname)
		.text("Collapse")
		.attr("class", "unclicked");			
		
		svg.append("text")
		.attr("x", 210)
		.attr("y", 30)
		.attr("class", "clickable")
		.attr("id", "expand_collapse_text_"+cname)
		.text("Collapse")
		.attr("onclick", "javascript:subgraphAction(this.textContent, this.id)");
		
	  }
	  
	  function headLabel(svg) {
	  
		svg.append("rect")
		.attr("x", 20)
		.attr("y", 10)
		.attr("width", 470)
		.attr("height", 35)
		.attr("fill", "none")
		.attr("stroke-width", 1)
		.attr("stroke", "black")
		.attr("class", "main_graph_head_border");
		
		svg.append("text")
		.attr("x", 30)
		.attr("y", 30)
		.attr("fill", "black")
		.text("Region:");
		
		svg.append("rect")
		.attr("x", 110)
		.attr("y", 10)
		.attr("width", 40)
		.attr("height", 30)
		.attr("id", "All")
		.text("All")
		.attr("class", "unclicked");
		
		svg.append("text")
		.attr("x", 120)
		.attr("y", 30)
		.text("All")
		.attr("class", "clickable")
		.attr("onclick", "javascript:headerAction(this.textContent)");
		
		
		svg.append("rect")
		.attr("x", 150)
		.attr("y", 10)
		.attr("width", 55)
		.attr("height", 30)
		.attr("id", "None")
		.text("All")
		.attr("class", "unclicked");
		
		svg.append("text")
		.attr("x", 160)
		.attr("y", 30)
		.text("None")
		.attr("class", "clickable")
		.attr("onclick", "javascript:headerAction(this.textContent)");
		

		svg.append("rect")
		.attr("x", 200)
		.attr("y", 10)
		.attr("width", 75)
		.attr("height", 30)
		.attr("id", "Expand_Collapse_Main_Rect")
		.text("Collapse")
		.attr("class", "unclicked");
		
				
		
		svg.append("text")
		.attr("x", 210)
		.attr("y", 30)
		.attr("id", "Expand_Collapse_Main_Text")
		.text("Collapse")
		.attr("class", "clickable")
		.attr("onclick", "javascript:headerAction(this.textContent)");
		
	  }
	  
	  function headerClicked(name) {
	  
		headerUnclickAll();
		
		$("#"+name).removeClass("unclicked");
		$("#"+name).addClass("clicked");
	  }
	  
	  function headerUnclickAll(){
		$("#All").removeClass("clicked");
		$("#None").removeClass("clicked");
		$("#Collapse").removeClass("clicked");
		
		$("#All").addClass("unclicked");
		$("#None").addClass("unclicked");
		$("#Collapse").addClass("unclicked");
		
		for(var cname in map) {
			
			if(map[cname] != null) {
				if($("#"+cname).hasClass("labelClicked")) {
					
					$("#"+cname).removeClass("labelClicked");
				}
				$("#"+cname).addClass("labelClicked");
			}
			else {
				$("#"+cname).removeClass("labelClicked");
			}
		}
		
	  }
	  
	  function removeAllSubSVG() {
	  
		for(var cname in map) {
			
				if(cname != null && map[cname] != null) {
					console.log(cname);
					var svgToRemove = map[cname];
					svgToRemove.remove();
					$("#sub_graph_td_"+cname).parent().remove();
					$("#"+cname).removeClass("labelClicked");
					map[cname] = null;
				}
			}
	  }
	  
	  function headerAction(action) {

		headerClicked(action);	  
		
		if(action == 'All') {
						
			removeAllSubSVG();
			for(var cname in map) {
			
				if(cname != null && map[cname] == null) {
					console.log(cname);
					formSubmit(cname);
				}
			}

		}
		
		else if(action == 'None') {
			
			removeAllSubSVG();
		}
		else if(action == 'Collapse') {
		
			$("#Expand_Collapse_Main_Text").text("Expand");
			$(".main_graph").hide();
			$(".main_graph_head_border").show();
			svg1.attr("height", 50);
		}
		else if(action == 'Expand') {
		
			$("#Expand_Collapse_Main_Text").text("Collapse");
			$(".main_graph").show();
			$(".main_graph_head_border").hide();
			svg1.attr("height", 350);
		}
	  }
	  
	  function subgraphAction(action, textId) {
	  
		var cname = textId.substring(21);

		if(action == 'Collapse') {
		
			$("#"+textId).text("Expand");
			$(".sub_graph_"+cname).hide();
			$("#sub_graph_head_border_"+cname).show();
			
			var svg = mapSubGraphSVG[cname];
			svg.attr("height", 50);
			
		}
		else if(action == 'Expand') {
		
			$("#"+textId).text("Collapse");
			$(".sub_graph_"+cname).show();
			$("#sub_graph_head_border_"+cname).hide();
			var svg = mapSubGraphSVG[cname];
			svg.attr("height", 350);			
		}
	  }
	 			
	  function render1(svg, data, color){
	    		
        // Bind data
		var rectGroup= svg.append("g");
		        
		var rects = rectGroup.selectAll("rect").data(data);
        var texts = rectGroup.selectAll("text").data(data);
        // Enter
        rects.enter().append("rect")
          .attr("x", 100)
          .attr("height", 30)
		  .attr("class", "main_graph");
		
		texts.enter().append("text")
		.attr("x", 30)
		.attr("class", "main_graph");;
        
		// Update
        rects.attr("y", function (d) { return 50+scale(d.cid);})
		  .attr("width",  function (d) { return scale(d.w);})
          .attr("fill", color);
		
			
		texts.attr("y", function (d) { return scale(d.cid) + 70;})
		.attr("fill", "black")
		.text(function (d) { map[d.cname] = null; return d.cname;});
		
		texts.attr("style", "cursor:pointer");
		texts.attr("id", function (d) { return d.cname;});
		texts.attr("onclick", "javascript:labelClicked(this.textContent)");
       
	   // Exit
        rects.exit().remove();
		
      }
      
	  function render2(svg, data, color){
	    		
        // Bind data
		var rectGroup= svg.append("g");
		        
		var rects = rectGroup.selectAll("rect").data(data);
        var texts = rectGroup.selectAll("text").data(data);
        // Enter
        rects.enter().append("rect")
          .attr("x", 100)
          .attr("height", 30);
		
		texts.enter().append("text")
		.attr("x", 30);
        
		// Update
        rects.attr("y", function (d) { return 50+scale(d.cid);})
		  .attr("width",  function (d) { return scale(d.w);})
          .attr("fill", color);
		
			
		texts.attr("y", function (d) { return scale(d.cid) + 70;})
		.attr("fill", "black")
		.text(function (d) { return d.cname;});
				
       
	   // Exit
        rects.exit().remove();
		
      }

	    
	  
	  var scale = d3.scale.linear()
        .domain([1, 5])   // Data space
        .range([10, 200]); // Pixel space
		
	  var svg1 = d3.select("#main_graph_td").append("svg:svg")
        .attr("width",  500)
        .attr("height", 350);
		
	  axis_MainGraph(svg1);
	  headLabel(svg1);
	
	
	var myArrayOfObjects = [ 
		{ cid: 1, cname:'ABC', w: 1}, 
		{ cid: 2, cname:'DEF', w: 2}, 
		{ cid: 3, cname:'GHI', w: 8}, 
		{ cid: 4, cname:'JKL', w: 4}, 
		{ cid: 5, cname:'MNO', w: 4} 
	];
	  
	 render1(svg1, myArrayOfObjects, "black"); 
	 	   
	
	function labelClicked(cname) {
	
		headerUnclickAll();
			
		formSubmit(cname);
	}
	
	function formSubmit(cname) {
				
		if(map[cname] != null) {
		
			var svgToRemove = map[cname];
			svgToRemove.remove();
			$("#"+cname).removeClass("labelClicked");
			$("#sub_graph_td_"+cname).parent().remove();
			map[cname] = null;	
			
			return;
		}
		
		$("#"+cname).addClass("labelClicked");
		
		$("#table_sub_graph").append('<tr><td id="sub_graph_td_'+cname +'"></td></tr>');
		var svg2 = d3.select("#sub_graph_td_"+cname).append("svg:svg")
        .attr("width",  500)
        .attr("height", 350);
		
		map[cname] = svg2; 
			
		axis_SubGraph(svg2, cname);
		var myArrayOfObjects = getMyArrayOfObjects(cname);
		render2(svg2, myArrayOfObjects, "black"); 
        
	}
    </script>
  </body>
  </html>