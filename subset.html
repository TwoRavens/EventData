<!DOCTYPE html>
<html>
<head>
    <title>TwoRavens</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="images/favicon.ico?v=1" type="image/x-icon">
    <link rel="stylesheet" href="subset.css">

    <script src="Ladda/dist/spin.min.js"></script>
    <script src="Ladda/dist/ladda.min.js"></script>

    <!--Used for rendering date calendar?-->
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery.ui.all.css">

    <!--NOTE: JQuery-ui must be loaded before bootstrap-->
    <script src="jquery/jquery.min.js"></script>
    <script src="jquery/jquery-ui.js"></script>

    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <script src="bootstrap/js/bootstrap.min.js"></script>

    <!--Used for right panel query tree-->
    <script src="jqtree/tree.jquery.js"></script>
    <link rel="stylesheet" href="jqtree/jqtree.css">
    <link rel="stylesheet" href="jqtree/jqtree.style.css">

    <script src="d3.v4.min.js"></script>

    </head>

<body>

<nav id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">
    <a class="navbar-brand" style="margin-left:0">
        <img src="images/TwoRavens.png" alt="TwoRavens" width="100" style="margin-left:2em;margin-top:-0.5em;"
             onmouseover="about();" onmouseout="closeabout();">
    </a>

    <div id="navbarNav" style="margin-top:11px">
        <label class="btn btn-default ladda-button navbar-right" style="margin-left:2em;margin-right:1em;"
               id="btnSubmit" onclick="submitQuery()" data-spinner-color="#000000"
               data-style="zoom-in"><span class="ladda-label">Subset</span></label>
        <button class="btn btn-default navbar-right" id="btnReset" title="Reset" onclick="reset()"
                style="margin-left:2.0em;"><span style="font-size:1em;color:#818181; pointer-events:none;"
                                                 class="glyphicon glyphicon-repeat"></span></button>
    </div>

    <div id="about" class="panel panel-default" style="margin-top:62px;width:500px;display:None;z-index:50;">
        <div class="panel-body"></div>
    </div>
</nav>

<div id="leftpanel" class="sidepanel container clearfix">
    <div id="toggleLpanelicon" class="panelbar"><span>&#9679;<br/>&#9679;<br/>&#9679;<br/>&#9679;</span></div>
    <div class="panel-heading text-center" id="leftpaneltitle">
        <h3 class="panel-title">Data Selection</h3>
    </div>

    <div id="leftpanelButtons" class="btn-group" data-toggle="buttons" style="margin-left:6px; width:calc(100% - 12px)">

        <label class="btn btn-default active" style="width:50%" onclick="tabLeft('variableTab');"
               title="Click variable name to add variables to data subset (select columns).">
            <input type="radio" id="btnVariables" style="width:50%;"
                    name="options" autocomplete="off" checked>Variables</input>
        </label>

        <label class="btn btn-default" style="width:50%" onclick="tabLeft('subsetTab');"
               title="Click subset name to configure subset options (select rows).">
            <input type="radio" id="btnSubset" style="width:50%;"
                    name="options" autocomplete="off">Subsets</input>
        </label>
    </div>
    <div id="leftpanelContent">
        <div id="variableTab" style="display:block;padding:10px 8px;text-align:center;width:100%;">
            <input type="text" id="searchvar" placeholder="Search Variables and Labels" class="form-control"
                   style="width:100%; margin-bottom:5px;"/>
            <div id="variableList"
                 style="display:inline;text-align:center;position:absolute;left:6px;top:128px;height:calc(100% - 128px);width:226px;overflow-y:scroll"></div>
        </div>
        <div id="subsetTab" style="display:none;padding:10px 8px;text-align:center;width:100%;height:100%;">
            <div id="subsetList" style="display:inline;text-align:center;position:absolute;left:6px;width:226px"></div>
        </div>
    </div>
</div>

<div id="rightpanel" class="sidepanel container clearfix">
    <div id="toggleRpanelicon" class="panelbar"><span>&#9679;<br/>&#9679;<br/>&#9679;<br/>&#9679;</span></div>

    <div class="panel-heading text-center" id="rightpaneltitle">
        <h3 class="panel-title">Query Summary</h3>
    </div>

    <div id="queryVariables" style="margin-left:5px;width:232px;height:calc(50% - 39px);overflow-y:auto">
        <h4 class="panel-title">Variables</h4>
        <div id="variableTree"
             style="margin-left:10px;width:calc(100% - 15px);height:calc(100% - 19px);overflow-y:auto"></div>
    </div>

    <div id="querySubsets" style="width:232px;height:calc(50% - 39px);">
        <h4 class="panel-title" style="margin-left:5px;">Subsets</h4>
        <div id="subsetTree" style="height:calc(100% - 19px);overflow-y:auto"></div>
    </div>

    <div id="rightpanelButtonBar" style="width:232px;position:absolute;bottom:5px">
        <button id="buttonAddGroup" class="btn btn-default ladda-button" data-spinner-color="#000000"
                onclick="addGroup()" type="button"
                style="float:left;margin-left:6px;">Group
        </button>
    </div>
</div>

<button id="stageButton" class="btn btn-default" type="button" onclick=addRule()>Stage</button>

<div id="ticker" class="ticker">
    <!--<a href="somelink" target="_blank" id="logID">Replication</a>-->
</div>

<div id="main" class="left" onresize=rightpanelMargin()>

    <div id="subsetDate" style="display:none">
        <svg id="dateSVG" width="500" height="500"></svg>

        <div id="dateInterval" class="form-group"
             style="display: inline-block;vertical-align:top;width:20%;margin:20px">
            <button id="setDatefromSlider" type="button" class="btn btn-default" onclick="setDatefromSlider()"
                    style="margin-top:10px;text-align:center;">Bring Date from Slider
            </button>
            <label id="dateFromLab" for="fromdate" style="text-align:left;width:100%;margin-top:10px;">From:</label>
            <input id="fromdate" class="form-control" type="text">
            <label id="dateToLab" for="todate" style="text-align:left;width:100%;margin-top:10px;">To:</label>
            <input id="todate" class="form-control" type="text">
        </div>
    </div>

    <div id="subsetLocation" style="display:none">
    </div>

    <div id="subsetAction" style="display:none">
		<svg id="actionMainGraph" width="500" height="500" style="border: 1px solid blue;"></svg>
		<svg id="actionSubGraph" width="500" height="500" style="border: 1px solid green;"></svg>
		<div class="SVGtooltip"></div>
    </div>

    <div id="subsetActor" style="display:none">
        <div id="actorContainer">

            <div id="actorSelectionDiv">
                <div id="actorSelectionTitle" class="panel-heading text-center">
                    <h3 class="panel-title">Actor Selection</h3>
                </div>

                <div id="tabDiv" style="overflow:hidden;">
                    <div id="actorRadio" class="btn-group" data-toggle="buttons" style="margin-left:6px; width:calc(100% - 12px)">
                        <label class="btn btn-default active" style="width:50%" title="Select sources"
                               onclick="actorTabSwitch('sourceTabBtn', 'sourceDiv')">
                            <input type="radio" id="sourceTabBtn" name="actorSet" autocomplete="off" checked>Sources</input>
                        </label>
                        <label class="btn btn-default" style="width:50%" title="Select targets"
                               onclick="actorTabSwitch('targetTabBtn', 'targetDiv')">
                            <input type="radio" id="targetTabBtn" name="actorSet" autocomplete="off">Targets</input>
                        </label>
                    </div>
                </div>

                <div id="groupNameDisplayContainer" class="panel-heading text-center" style="padding-bottom:0px;">
                    <input id="editGroupName" type="text" placeholder="Source 0" data-toggle="tooltip"
                           title="Click to change group name"/>    <!--change placeholder on group -->
                    <button id="deleteGroup" type="button" data-toggle="tooltip" title="Delete current group"></button>
                </div>

                <div id="fullContainer">
                    <div id="sourceDiv" class="actorTabContent">
                        <div id="allSources" class="actorLeft">
                            <input id="sourceSearch" class="form-control actorSearch" placeholder="Search source actors"
                                   type="text"/>

                            <div id="searchListSources" class="actorFullList">
                                <!--checks will be added dynamically in JS once at load-->
                            </div>
                        </div>

                        <div class="actorRight">
                            <button id="clearAllSources" type="button" data-toggle="tooltip" class="clearActorBtn"
                                    title="Clears search text and filters">Clear All Filters
                            </button>

                            <div id="sourceFilter" class="actorFilterList">
                                <label title="Show selected sources" data-toggle="tooltip"
                                       class="actorShowSelectedLbl actorChkLbl"><input
                                        class="actorChk actorShowSelected" name="sourceShowSelected"
                                        id="sourceShowSelected" type="checkbox" value="show"
                                        onchange="showSelected(this)">Show Selected</label>
                                <div class="seperator"></div>

                                <!--dynamically add checks for filters at load-->
                                <button id="entitySourceExpand" class="filterExpand" value="expand"></button>
                                <label id="entitySources" class="actorHead4"
                                       for="entitySourceExpand"><b>Entity</b></label>
                                <div id="wrapEntitySource" class="filterContainer" style="padding-left:10px;">
                                    <button id="orgSourceExpand" class="filterExpand" value="expand"></button>
                                    <label class="actorChkLbl"><input class="actorChk allCheck" name="sourceOrgAllCheck"
                                                                      id="sourceOrgAllCheck" type="checkbox"
                                                                      value="organizations">Organizations</label>
                                    <div id="orgSourcesList" class="filterContainer" style="padding-left:30px;"></div>

                                    <div class="seperator"></div>

                                    <button id="countrySourceExpand" class="filterExpand" value="expand"></button>
                                    <label class="actorChkLbl"><input class="actorChk allCheck"
                                                                      name="sourceCountryAllCheck"
                                                                      id="sourceCountryAllCheck" type="checkbox"
                                                                      value="countries">Countries</label>
                                    <div id="countrySourcesList" class="filterContainer"
                                         style="padding-left:30px;"></div>
                                </div>

                                <div class="seperator"></div>

                                <button id="roleSourceExpand" class="filterExpand" value="expand"></button>
                                <label id="roleSources" class="actorHead4" for="roleSourceExpand"><b>Role</b></label>
                                <div id="roleSourcesList" class="filterContainer"></div>

                                <div class="seperator"></div>

                                <button id="attributeSourceExpand" class="filterExpand" value="expand"></button>
                                <label id="attributeSources" class="actorHead4" for="attributeSourceExpand"><b>Attributes</b></label>
                                <div id="attributeSourcesList" class="filterContainer"></div>
                            </div>
                        </div>

                        <button id="sourceSelectAll" class="actorBottom actorSelectAll" type="button"
                                data-toggle="tooltip" title="Selects all sources that match the filter criteria">Select
                            All
                        </button>

                        <button id="sourceClearSel" class="actorBottom actorClearAll" type="button"
                                data-toggle="tooltip" title="Clears all sources that match the filter criteria">Clear
                            All
                        </button>

                        <button id="sourceNew" class="actorBottom actorNewGroup" type="button" data-toggle="tooltip"
                                title="Create new source group">New Group
                        </button>
                    </div>

                    <div id="targetDiv" class="actorTabContent">
                        <div id="allTargets" class="actorLeft">
                            <input id="targetSearch" class="form-control actorSearch" placeholder="Search target actors"
                                   type="text">

                            <div id="searchListTargets" class="actorFullList">
                                <!--checks will be added dynamically in JS once at load-->
                            </div>
                        </div>

                        <div class="actorRight">
                            <button id="clearAllTargets" type="button" data-toggle="tooltip" class="clearActorBtn"
                                    title="Clears search text and filters">Clear All Filters
                            </button>

                            <div id="targetFilter" class="actorFilterList">
                                <label title="Show selected targets" data-toggle="tooltip"
                                       class="actorShowSelectedLbl actorChkLbl"><input
                                        class="actorChk actorShowSelected" name="targetShowSelected"
                                        id="targetShowSelected" type="checkbox" value="show"
                                        onchange="showSelected(this)">Show Selected</label>
                                <div class="seperator"></div>

                                <!--dynamically add checks for filters at load-->
                                <button id="entityTargetExpand" class="filterExpand" value="expand"></button>
                                <label id="entityTargets" class="actorHead4"
                                       for="entityTargetExpand"><b>Entity</b></label>
                                <div id="wrapEntityTarget" class="filterContainer" style="padding-left:10px;">
                                    <button id="orgTargetExpand" class="filterExpand" value="expand"></button>
                                    <label class="actorChkLbl"><input class="actorChk allCheck" name="targetOrgAllCheck"
                                                                      id="targetOrgAllCheck" type="checkbox"
                                                                      value="organizations">Organizations</label>
                                    <div id="orgTargetsList" class="filterContainer" style="padding-left:30px;"></div>

                                    <div class="seperator"></div>

                                    <button id="countryTargetExpand" class="filterExpand" value="expand"></button>
                                    <label class="actorChkLbl"><input class="actorChk allCheck"
                                                                      name="targetCountryAllCheck"
                                                                      id="targetCountryAllCheck" type="checkbox"
                                                                      value="countries">Countries</label>
                                    <div id="countryTargetsList" class="filterContainer"
                                         style="padding-left:30px;"></div>
                                </div>

                                <div class="seperator"></div>

                                <button id="roleTargetExpand" class="filterExpand" value="expand"></button>
                                <label id="roleTargets" class="actorHead4" for="roleTargetExpand"><b>Role</b></label>
                                <div id="roleTargetsList" class="filterContainer"></div>

                                <div class="seperator"></div>

                                <button id="attributeTargetExpand" class="filterExpand" value="expand"></button>
                                <label id="attributeTargets" class="actorHead4" for="attributeTargetExpand"><b>Attributes</b></label>
                                <div id="attributeTargetsList" class="filterContainer"></div>
                            </div>
                        </div>

                        <button id="targetSelectAll" class="actorBottom actorSelectAll" type="button"
                                data-toggle="tooltip" title="Selects all targets that match the filter criteria">Select
                            All
                        </button>

                        <button id="targetClearSel" class="actorBottom actorClearAll" type="button"
                                data-toggle="tooltip" title="Clears all targets that match the filter criteria">Clear
                            All
                        </button>

                        <button id="targetNew" class="actorBottom actorNewGroup" type="button" data-toggle="tooltip"
                                title="Create new target group">New Group
                        </button>
                    </div>
                </div>
            </div>

            <div id="actorLinkDiv">
                <div id="linkTitle">
                    <h3 id="linkTitleLeft" class="panel-title text-center">Sources</h3>
                    <h3 id="linkTitleRight" class="panel-title text-center">Targets</h3>
                </div>

                <svg id="actorLinkSVG"></svg>
            </div>
        </div>
    </div>
</div>

<script>
    function about() { $('#about').show(); }
    function closeabout() { $('#about').hide(); }
    // note that .textContent is the new way to write text to a div
    $('#about div.panel-body').text('TwoRavens v0.1 "Dallas" -- The Norse god Odin had two talking ravens as advisors, who would fly out into the world and report back all they observed.  In the Norse, their names were "Thought" and "Memory".  In our coming release, our thought-raven automatically advises on statistical model selection, while our memory-raven accumulates previous statistical models from Dataverse, to provide cumulative guidance and meta-analysis.');
    //This is the first public release of a new, interactive Web application to explore data, view descriptive statistics, and estimate statistical models.";


    // Open/Close Panels
    $('#leftpanel span').click(function () {
        toggleLeftPanel();
    });
    $('#rightpanel span').click(function () {
        toggleRightPanel();
    });

    function toggleLeftPanel() {
        if (!$('#leftpanel').hasClass('forceclosepanel')) {
            $('#leftpanel').removeClass('expandpanel');
            $('#leftpanel > div.row-fluid').toggleClass('closepanel');
            $('#leftpanel').toggleClass('closepanel');
        }

        if ($('#leftpanel').hasClass('closepanel')) {
            $('#main').css('margin-left', '46px');
            $('#main').css('width', 'calc(100% - 46px)');
        } else {
            $('#main').css('margin-left', '270px');
            $('#main').css('width', 'calc(100% - 270px)');
        }
    }

    function toggleRightPanel() {
        if (!$('#rightpanel').hasClass('forceclosepanel')) {
            /*$('#rightpanel .nav-tabs').hide();*/
            $('#rightpanel').removeClass('expandpanel');
            $('#rightpanel > div.row-fluid').toggleClass('closepanel');
            $('#rightpanel').toggleClass('closepanel');
            rightpanelMargin();
        }
    }

    var myurl = window.location.toString();
    var fileid = "";
    var cindex = 0;
    if (myurl.indexOf("dfId=") > 0) {
        fileid = myurl.substring(myurl.indexOf("dfId=") + 5);
        cindex = fileid.indexOf("&");
        if (cindex > 0) {
            fileid = fileid.substring(0, cindex);
        }
    }
    var hostname = "";
    if (myurl.indexOf("host=") > 0) {
        hostname = myurl.substring(myurl.indexOf("host=") + 5);
        cindex = hostname.indexOf("&");
        if (cindex > 0) {
            hostname = hostname.substring(0, cindex);
        }
    }
    var apikey = "";
    if (myurl.indexOf("key=") > 0) {
        apikey = myurl.substring(myurl.indexOf("key=") + 4);
        cindex = apikey.indexOf("&");
        if (cindex > 0) {
            apikey = apikey.substring(0, cindex);
        }
    }
    var ddiurl = "";
    if (myurl.indexOf("ddiurl=") > 0) {
        ddiurl = myurl.substring(myurl.indexOf("ddiurl=") + 7);
        ddiurl = ddiurl.replace(/%25/g, "%");
        ddiurl = ddiurl.replace(/%3A/g, ":");
        ddiurl = ddiurl.replace(/%2F/g, "/");
        cindex = ddiurl.indexOf("&");
        if (cindex > 0) {
            ddiurl = ddiurl.substring(0, cindex);
        }
    }
    var dataurl = "";
    if (myurl.indexOf("dataurl=") > 0) {
        dataurl = myurl.substring(myurl.indexOf("dataurl=") + 8);
        dataurl = dataurl.replace(/%25/g, "%");
        dataurl = dataurl.replace(/%3A/g, ":");
        dataurl = dataurl.replace(/%2F/g, "/");
        cindex = dataurl.indexOf("&");
        if (cindex > 0) {
            dataurl = dataurl.substring(0, cindex);
        }
    }

    var username = "";
    if (myurl.indexOf("username=") > 0) {
        username = myurl.substring(myurl.indexOf("dataurl=") + 8);
        username = username.replace(/%25/g, "%");
        username = username.replace(/%3A/g, ":");
        username = username.replace(/%2F/g, "/");
        username = username.indexOf("&");
        if (cindex > 0) {
            username = username.substring(0, cindex);
        }
    }
    else {
        username = "rohit";
    }

    //  console.log("fileid: "+fileid);
    //  console.log("hostname: "+hostname);
    //  console.log("apikey: "+apikey);
    //  console.log("ddiurl: "+ddiurl);
    //  console.log("dataurl: "+dataurl);
    //  console.log("Username:"+username);
</script>
<script id="subsetCodeJS" type="text/javascript" src="src/subset/app.js"></script>

<!--Each subsetting panel-->
<script id="dateCodeJS" type="text/javascript" src="src/subset/views/Date.js"></script>
<script id="locationCodeJS" type="text/javascript" src="src/subset/views/Location.js"></script>
<script id="actionCodeJS" type="text/javascript" src="src/subset/views/Action.js"></script>
<script id="actorCodeJS" type="text/javascript" src="src/subset/views/Actor.js"></script>
</body>
</html>

